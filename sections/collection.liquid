{%- comment -%}
  Renders the main collection page, including a header, sorting,
  product grid, and pagination.
{%- endcomment -%}

{{ 'collection-page.css' | asset_url | stylesheet_tag }}

{%- paginate collection.products by section.settings.products_per_page -%}

<div class="collection-page page-width">
  
  <header class="collection-header">
    {%- if section.settings.show_collection_image and collection.image -%}
      <div class="collection-header__image">
        <img
          src="{{ collection.image | image_url: width: 1200 }}"
          alt="{{ collection.image.alt | default: collection.title | escape }}"
          width="1200"
          height="{{ 1200 | divided_by: collection.image.aspect_ratio | round }}"
        >
      </div>
    {%- endif -%}
    <div class="collection-header__info">
      <h1>{{ collection.title }}</h1>
      {%- if collection.description != blank -%}
        <p>{{ collection.description }}</p>
      {%- endif -%}
    </div>
  </header>

  <div class="collection-toolbar">
    <div class="collection-toolbar__sort">
      <label for="sort-by">Sort by:</label>
      <select name="sort_by" id="sort-by" data-default-sort="{{ collection.default_sort_by }}">
        {%- for option in collection.sort_options -%}
          <option value="{{ option.value }}" {% if option.value == collection.sort_by %}selected="selected"{% endif %}>
            {{ option.name }}
          </option>
        {%- endfor -%}
      </select>
    </div>
  </div>

  <div class="collection-grid" style="--columns: {{ section.settings.columns }};">
    {%- for product in collection.products -%}
      {% render 'product-card', product: product %}
    {%- else -%}
      <p>No products found in this collection.</p>
    {%- endfor -%}
  </div>

  {%- if paginate.pages > 1 -%}
    <div class="pagination">
      {{ paginate | default_pagination }}
    </div>
  {%- endif -%}

</div>

{%- endpaginate -%}

<script>
  document.getElementById('sort-by').addEventListener('change', function() {
    const url = new URL(window.location.href);
    url.searchParams.set('sort_by', this.value);
    window.location = url.href;
  });
</script>

{% schema %}
{
  "name": "Collection Page",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 48,
      "step": 4,
      "label": "Products per page",
      "default": 16
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "Columns on desktop",
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "show_collection_image",
      "label": "Show collection image",
      "default": true
    }
  ]
}
{% endschema %}
